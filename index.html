<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Crypto Dashboard</title>
  <style>
    :root {
      --bg: #121212;
      --text: #fff;
      --accent: orange;
    }
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', sans-serif;
    }
    body {
      background: var(--bg);
      color: var(--text);
      padding-bottom: 100px;
    }
    nav {
      position: fixed;
      top: 0;
      width: 100%;
      background: #1e1e1e;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 30px;
      z-index: 100;
    }
    .logo {
      color: var(--accent);
      font-size: 1.5rem;
      font-weight: bold;
    }
    .nav-links {
      display: flex;
      gap: 20px;
    }
    .nav-links a {
      color: var(--text);
      text-decoration: none;
      font-weight: 500;
    }
    .nav-links a:hover {
      color: var(--accent);
    }
    .container {
      max-width: 1200px;
      margin: 100px auto 0;
      padding: 0 20px;
    }
    .search-bar {
      margin-bottom: 20px;
      text-align: center;
    }
    .search-bar input {
      padding: 10px 20px;
      width: 80%;
      border-radius: 8px;
      border: none;
      font-size: 1rem;
    }
    .coins {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
    }
    .coin {
      background: #1c1c1c;
      padding: 15px;
      border-radius: 10px;
      text-align: center;
      position: relative;
    }
    .coin img {
      width: 40px;
      height: 40px;
    }
    .coin h2 {
      margin: 10px 0;
    }
    .price-up {
      color: lightgreen;
    }
    .price-down {
      color: red;
    }
    .star {
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 1.2rem;
      cursor: pointer;
      color: gray;
    }
    .star.active {
      color: gold;
    }
    section {
      margin-top: 60px;
    }
    h1, h2 {
      text-align: center;
      margin-bottom: 20px;
    }
    .portfolio-form input, .portfolio-form button {
      padding: 8px;
      margin: 5px;
    }
  </style>
</head>
<body>
  <nav>
    <div class="logo">CryptoDash</div>
    <div class="nav-links">
      <a href="#">Home</a>
      <a href="#watchlist">Watchlist</a>
      <a href="#portfolio">Portfolio</a>
    </div>
  </nav>

  <div class="container">
    <div class="search-bar">
      <input type="text" id="search" placeholder="Search coins...">
    </div>

    <div id="coins" class="coins"></div>

    <section id="watchlist">
      <h2>‚≠ê Watchlist</h2>
      <div id="watchlist-container" class="coins"></div>
    </section>

    <section id="portfolio">
      <h2>üíº Portfolio</h2>
      <form class="portfolio-form" onsubmit="addToPortfolio(event)">
        <input type="text" id="coin-symbol" placeholder="Symbol (e.g. BTC)" required>
        <input type="number" id="quantity" placeholder="Quantity" required>
        <input type="number" id="buy-price" placeholder="Buy Price" required>
        <button type="submit">Add</button>
      </form>
      <div id="portfolio-list"></div>
    </section>
  </div>

  <script>
    let allCoins = [];
    const coinsEl = document.getElementById('coins');
    const searchInput = document.getElementById('search');
    const watchlistContainer = document.getElementById('watchlist-container');
    const portfolioList = document.getElementById('portfolio-list');

    const watchlist = JSON.parse(localStorage.getItem('watchlist') || '[]');
    const portfolio = JSON.parse(localStorage.getItem('portfolio') || '[]');

    const fetchCoins = async () => {
      const res = await fetch('https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd');
      const data = await res.json();
      allCoins = data;
      renderCoins(data);
      renderWatchlist();
      renderPortfolio();
    };

    const renderCoins = (coins) => {
      coinsEl.innerHTML = coins.map(coin => `
        <div class="coin">
          <img src="${coin.image}" alt="${coin.name}" />
          <h2>${coin.name} (${coin.symbol.toUpperCase()})</h2>
          <p>$${coin.current_price.toFixed(2)}</p>
          <p class="${coin.price_change_percentage_24h >= 0 ? 'price-up' : 'price-down'}">
            ${coin.price_change_percentage_24h.toFixed(2)}%
          </p>
          <span class="star ${watchlist.includes(coin.id) ? 'active' : ''}" onclick="toggleWatchlist('${coin.id}')">‚òÖ</span>
        </div>
      `).join('');
    };

    const toggleWatchlist = (id) => {
      const index = watchlist.indexOf(id);
      if (index > -1) {
        watchlist.splice(index, 1);
      } else {
        watchlist.push(id);
      }
      localStorage.setItem('watchlist', JSON.stringify(watchlist));
      renderCoins(allCoins);
      renderWatchlist();
    };

    const renderWatchlist = () => {
      const watchCoins = allCoins.filter(coin => watchlist.includes(coin.id));
      watchlistContainer.innerHTML = watchCoins.map(coin => `
        <div class="coin">
          <img src="${coin.image}" alt="${coin.name}" />
          <h2>${coin.name}</h2>
          <p>$${coin.current_price.toFixed(2)}</p>
          <p>${coin.symbol.toUpperCase()}</p>
        </div>
      `).join('');
    };

    const addToPortfolio = (e) => {
      e.preventDefault();
      const symbol = document.getElementById('coin-symbol').value.toUpperCase();
      const quantity = parseFloat(document.getElementById('quantity').value);
      const buyPrice = parseFloat(document.getElementById('buy-price').value);
      const coin = allCoins.find(c => c.symbol.toUpperCase() === symbol);
      if (!coin) return alert('Invalid coin symbol!');

      portfolio.push({ symbol, quantity, buyPrice });
      localStorage.setItem('portfolio', JSON.stringify(portfolio));
      renderPortfolio();
      e.target.reset();
    };

    const renderPortfolio = () => {
      portfolioList.innerHTML = portfolio.map(entry => {
        const coin = allCoins.find(c => c.symbol.toUpperCase() === entry.symbol);
        const currentValue = coin ? (coin.current_price * entry.quantity).toFixed(2) : 'N/A';
        const profitLoss = coin ? (coin.current_price - entry.buyPrice) * entry.quantity : 0;
        return `
          <div class="coin">
            <h3>${entry.symbol}</h3>
            <p>Quantity: ${entry.quantity}</p>
            <p>Buy @ $${entry.buyPrice}</p>
            <p>Current: $${currentValue}</p>
            <p style="color:${profitLoss >= 0 ? 'lightgreen' : 'red'}">P/L: $${profitLoss.toFixed(2)}</p>
          </div>
        `;
      }).join('');
    };

    searchInput.addEventListener('input', e => {
      const val = e.target.value.toLowerCase();
      const filtered = allCoins.filter(c => c.name.toLowerCase().includes(val) || c.symbol.toLowerCase().includes(val));
      renderCoins(filtered);
    });

    fetchCoins();
  </script>
</body>
</html>
